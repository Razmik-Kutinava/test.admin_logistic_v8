// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Driver {
  id            Int          @id @default(autoincrement())
  name          String
  phone         String
  email         String?      @unique
  licenseNumber String?
  vehicleType   String?
  status        DriverStatus @default(ACTIVE)
  districtId    Int?
  district      District?    @relation(fields: [districtId], references: [id])
  deliveries    Delivery[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@map("drivers")
}

enum DriverStatus {
  ACTIVE
  INACTIVE
  ON_DELIVERY
}

model Order {
  id             Int           @id @default(autoincrement())
  orderNumber    String        @unique
  address        String
  recipientPhone String
  description    String?
  priority       OrderPriority @default(NORMAL)
  warehouseId    Int
  warehouse      Warehouse     @relation(fields: [warehouseId], references: [id])
  delivery       Delivery?
  districtId     Int?
  district       District?     @relation(fields: [districtId], references: [id])
  status         OrderStatus   @default(NEW)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("orders")
}

enum OrderStatus {
  NEW
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OrderPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

model Delivery {
  id           Int            @id @default(autoincrement())
  orderId      Int            @unique
  order        Order          @relation(fields: [orderId], references: [id])
  driverId     Int
  driver       Driver         @relation(fields: [driverId], references: [id])
  status       DeliveryStatus @default(ASSIGNED)
  pickupTime   DateTime?
  deliveryTime DateTime?
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  @@map("deliveries")
}

enum DeliveryStatus {
  ASSIGNED
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  FAILED
}

model District {
  id         Int      @id @default(autoincrement())
  name       String
  city       String
  country    String
  boundaries Json?
  streets    String[]
  drivers    Driver[]
  orders     Order[]
  zoneId     Int?
  zone       Zone?    @relation(fields: [zoneId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("districts")
}

model Zone {
  id        Int        @id @default(autoincrement())
  name      String
  districts District[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("zones")
}

model Warehouse {
  id        Int      @id @default(autoincrement())
  name      String
  address   String
  city      String
  country   String
  type      String?
  orders    Order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("warehouses")
}

model SystemLog {
  id         Int      @id @default(autoincrement())
  action     String
  entityType String
  entityId   Int?
  userId     Int?
  details    Json?
  createdAt  DateTime @default(now())

  @@map("system_logs")
}
